<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Checkout - Teste de Prosperidade</title>
    
    <!-- DEVICE FINGERPRINT PRIMEIRO -->
    <script src="https://www.mercadopago.com/v2/security.js" view="checkout"></script>
    
    <!-- SDK OFICIAL MERCADO PAGO -->
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5; min-height: 100vh; padding: 20px;
            display: flex; align-items: center; justify-content: center;
        }

        .checkout-container {
            max-width: 500px; width: 100%; background: white; border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1); overflow: hidden;
        }

        .checkout-header {
            padding: 24px 32px 20px; background: white; border-bottom: 1px solid #f0f0f0;
        }

        .checkout-header h2 { font-size: 20px; font-weight: 500; color: #333; margin-bottom: 8px; }
        .amount-display { font-size: 24px; font-weight: 600; color: #00a650; margin-bottom: 12px; }
        .completion-message {
            font-size: 14px; color: #666; background: #f8f9fa; padding: 12px 16px;
            border-radius: 6px; border: 1px solid #e9ecef; text-align: center; margin-top: 8px;
        }
        .completion-message .icon { margin-right: 6px; }

        /* USER INFO DISPLAY */
        .user-info {
            font-size: 12px; color: #666; background: #e6f7ff; padding: 8px 16px;
            border-radius: 4px; margin-top: 8px; border: 1px solid #91d5ff;
        }
        .user-info .uid { font-weight: 500; color: #1890ff; }
        .user-info .email { color: #52c41a; }

        .payment-container { padding: 0; background: white; }
        #paymentBrick_container { min-height: 400px; }

        .loading-state { padding: 60px 32px; text-align: center; color: #666; }
        .spinner {
            width: 32px; height: 32px; border: 3px solid #f3f3f3; border-top: 3px solid #009ee3;
            border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .mp-logo-footer {
            padding: 12px 32px 8px; text-align: center; background: white; border-top: 1px solid #f0f0f0;
        }
        .mp-logo-img { height: 64px; margin-bottom: 8px; opacity: 0.9; }
        .mp-security-text { font-size: 12px; color: #666; font-weight: 500; }

        /* STATUS SCREENS */
        .status-screen {
            display: none; background: #f5f5f5; min-height: 100vh; width: 100%;
            position: fixed; top: 0; left: 0; z-index: 1000; padding: 20px; overflow-y: auto;
        }
        .status-container { max-width: 600px; margin: 0 auto; padding-top: 40px; }
        .status-header {
            border-radius: 20px 20px 0 0; padding: 60px 0 20px; text-align: center;
            display: flex; flex-direction: column; align-items: center;
        }
        .status-header.success { background: linear-gradient(135deg, #52c41a, #389e0d); }
        .status-header.processing { background: linear-gradient(135deg, #fa8c16, #d46b08); }
        .status-header.error { background: linear-gradient(135deg, #ff4d4f, #cf1322); }
        .status-icon {
            width: 80px; height: 80px; border-radius: 50%; background: rgba(255, 255, 255, 0.2);
            border: 3px solid white; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 36px; font-weight: bold;
        }
        .status-content {
            background: white; border-radius: 0 0 20px 20px; padding: 60px 40px 120px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .status-title { font-size: 28px; font-weight: 600; color: #333; text-align: center; margin-bottom: 20px; }
        .status-subtitle { font-size: 16px; color: #666; text-align: center; margin-bottom: 30px; line-height: 1.5; }
        .payment-details {
            background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #e9ecef;
        }
        .detail-row { display: flex; align-items: center; margin-bottom: 16px; }
        .detail-row:last-child { margin-bottom: 0; }
        .detail-icon {
            width: 40px; height: 40px; border-radius: 50%; background: #fff3cd;
            display: flex; align-items: center; justify-content: center; margin-right: 16px; flex-shrink: 0;
        }
        .detail-content { flex: 1; }
        .detail-title { font-size: 16px; font-weight: 500; color: #333; margin-bottom: 4px; }
        .detail-subtitle { font-size: 14px; color: #666; }

        .countdown-section {
            text-align: center; margin: 30px 0; padding: 20px; background: #e6f7ff;
            border-radius: 8px; border: 1px solid #91d5ff;
        }
        .countdown-text { font-size: 16px; color: #1890ff; margin-bottom: 8px; }
        .countdown-timer { font-size: 24px; font-weight: 600; color: #1890ff; }

        .action-button {
            width: 100%; max-width: 300px; padding: 16px; background: #1890ff; color: white;
            border: none; border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer;
            transition: background 0.3s ease; margin: 16px auto; display: block; margin-bottom: 60px;
        }
        .action-button:hover { background: #40a9ff; }
        .action-button:disabled { background: #d9d9d9; cursor: not-allowed; }

        .back-link {
            display: block; text-align: center; color: #1890ff; text-decoration: none; font-size: 16px; padding: 12px;
        }
        .back-link:hover { text-decoration: underline; }

        .pix-info {
            background: #f0f9ff; border: 1px solid #b3d4fc; border-radius: 8px;
            padding: 32px; margin-top: 20px; min-height: 520px;
        }
        .pix-qr { text-align: center; margin: 20px 0; }
        .pix-qr img { max-width: 200px; border: 1px solid #ddd; border-radius: 8px; }
        .pix-code {
            background: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 12px;
            font-family: monospace; font-size: 12px; word-break: break-all; margin: 10px 0;
        }
        .copy-button {
            background: #52c41a; color: white; border: none; padding: 8px 16px;
            border-radius: 4px; cursor: pointer; font-size: 14px;
        }
        .copy-button:hover { background: #389e0d; }

        .status-indicator {
            position: fixed; top: 20px; right: 20px; background: #52c41a; color: white;
            padding: 8px 12px; border-radius: 20px; font-size: 12px; z-index: 1001; display: none;
        }
        .status-indicator.checking { background: #fa8c16; }
        .status-indicator.error { background: #ff4d4f; }

        .warning-box {
            background: #fff2e8; border: 1px solid #ffbb96; border-radius: 8px;
            padding: 16px; margin: 20px 0; text-align: center;
        }
        .warning-box .warning-text { color: #d46b08; font-weight: 500; margin-bottom: 8px; }
        .warning-box .warning-subtext { color: #666; font-size: 14px; }

        @media (max-width: 600px) {
            .checkout-container { margin: 0 16px; max-width: none; }
            .checkout-header { padding: 20px 24px 12px; }
            .status-container { padding-top: 20px; }
            .status-content { padding: 60px 24px 24px; }
            .status-title { font-size: 24px; }
            .status-icon { width: 70px; height: 70px; font-size: 32px; }
            .action-button { width: 90%; max-width: 280px; }
        }

        .fade-out { opacity: 0; transform: translateY(-20px); }
        .fade-in { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>
    <div id="statusIndicator" class="status-indicator">‚óè Conectado</div>

    <div id="checkoutSection" class="checkout-container">
        <div class="checkout-header">
            <h2>Teste de Prosperidade</h2>
            <div class="amount-display">R$ 19,00</div>
            <div class="completion-message">
                <span class="icon">üí°</span>
                Complete o pagamento para acessar seu resultado personalizado
            </div>
            <!-- EXIBIR DADOS CAPTURADOS DA URL -->
            <div id="userInfo" class="user-info" style="display: none;">
                <span class="uid">UID: <span id="displayUID"></span></span> | 
                <span class="email">Email: <span id="displayEmail"></span></span>
            </div>
        </div>

        <div class="payment-container">
            <div id="paymentBrick_container">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Carregando formas de pagamento...</p>
                </div>
            </div>
        </div>

        <div class="mp-logo-footer">
            <img src="https://raw.githubusercontent.com/renatoambrosi/mpfullbackfront/main/EXEMPLOS/quizfront-main/mercado_pago-logo.png" 
                 alt="Mercado Pago" class="mp-logo-img">
            <div class="mp-security-text">Pagamento 100% seguro</div>
        </div>
    </div>

    <div id="statusScreen" class="status-screen">
        <div class="status-container">
            <div id="statusHeader" class="status-header success">
                <div id="statusIcon" class="status-icon">‚úì</div>
            </div>
            <div class="status-content">
                <h1 id="statusTitle" class="status-title">Seu pagamento foi aprovado</h1>
                <p id="statusSubtitle" class="status-subtitle"></p>
                
                <div class="payment-details">
                    <div class="detail-row">
                        <div class="detail-icon">üí∞</div>
                        <div class="detail-content">
                            <div class="detail-title">R$ 19,00</div>
                            <div class="detail-subtitle">Teste de Prosperidade</div>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-icon">üìã</div>
                        <div class="detail-content">
                            <div class="detail-title">Opera√ß√£o #<span id="paymentId"></span></div>
                            <div class="detail-subtitle" id="operationDate"></div>
                        </div>
                    </div>
                    <!-- EXIBIR EMAIL REAL NO STATUS -->
                    <div class="detail-row">
                        <div class="detail-icon">üìß</div>
                        <div class="detail-content">
                            <div class="detail-title">Email: <span id="statusEmail"></span></div>
                            <div class="detail-subtitle">Confirma√ß√£o enviada</div>
                        </div>
                    </div>
                </div>

                <div id="pixWarning" class="warning-box" style="display: none;">
                    <div class="warning-text">Pagamento n√£o confirmado</div>
                    <div class="warning-subtext">Verificando automaticamente. Aguarde ou efetue o pagamento PIX.</div>
                </div>

                <div id="pixSection" class="pix-info" style="display: none;">
                    <h3>Pagamento PIX</h3>
                    <div class="pix-qr">
                        <img id="pixQRCode" src="" alt="QR Code PIX" style="display: none;">
                    </div>
                    <div>
                        <strong>C√≥digo PIX para copiar:</strong>
                        <div id="pixCode" class="pix-code"></div>
                        <button class="copy-button" onclick="copyPixCode()">Copiar c√≥digo</button>
                    </div>
                </div>

                <div id="countdownSection" class="countdown-section">
                    <div class="countdown-text">Redirecionando para seu resultado em:</div>
                    <div id="countdownTimer" class="countdown-timer">10</div>
                </div>

                <button id="resultButton" class="action-button">Ver Resultado do Teste Agora</button>
                <a href="https://mpfullfront.vercel.app" class="back-link">Voltar √† p√°gina inicial</a>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CAPTURA DE DADOS DA URL - EMAIL REAL
        // ============================================
        
        const BACKEND_URL = 'https://mpfullbackfront-production.up.railway.app';
        const PUBLIC_KEY = 'APP_USR-d46b1349-ce1d-4bea-b49d-8c5e5d7f82b6';
        
        const urlParams = new URLSearchParams(window.location.search);
        const tallyUID = urlParams.get('uid');
        const userEmail = urlParams.get('email');
        const userUID = tallyUID || 'checkout-' + Date.now();
        
        console.log('üîó URL completa:', window.location.href);
        console.log('üéØ UID capturada:', tallyUID);
        console.log('üìß Email capturado:', userEmail);
        console.log('üÜî UID final:', userUID);
        
        // VALIDAR E EXIBIR DADOS CAPTURADOS
        function validateAndDisplayUserData() {
            const userInfoDiv = document.getElementById('userInfo');
            const displayUID = document.getElementById('displayUID');
            const displayEmail = document.getElementById('displayEmail');
            
            if (tallyUID || userEmail) {
                displayUID.textContent = tallyUID || 'N/A';
                displayEmail.textContent = userEmail || 'N/A';
                userInfoDiv.style.display = 'block';
                
                console.log('‚úÖ Dados do usu√°rio exibidos na interface');
            } else {
                console.log('‚ö†Ô∏è Nenhum dado de usu√°rio na URL');
            }
        }
        
        // VALIDAR EMAIL FORMAT
        function isValidEmail(email) {
            if (!email) return false;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // OBTER EMAIL FINAL PARA PAGAMENTO
        function getFinalEmail() {
            if (isValidEmail(userEmail)) {
                console.log('‚úÖ Usando email real da URL:', userEmail);
                return userEmail;
            } else {
                console.log('‚ö†Ô∏è Email inv√°lido ou n√£o fornecido, usando gen√©rico');
                return 'cliente@testeprospero.com.br';
            }
        }
        
        const finalEmail = getFinalEmail();
        
        // Inicializar MP
        const mp = new MercadoPago(PUBLIC_KEY, { locale: 'pt' });
        const bricksBuilder = mp.bricks();

        console.log('üöÄ MP inicializado, aguardando device fingerprint...');
        
        // AGUARDAR DEVICE FINGERPRINT
        function waitForDeviceFingerprint() {
            return new Promise((resolve) => {
                const maxAttempts = 50;
                let attempts = 0;
                
                const checkDevice = () => {
                    attempts++;
                    if (window.MP_DEVICE_SESSION_ID) {
                        console.log('üõ°Ô∏è Device fingerprint OK:', window.MP_DEVICE_SESSION_ID.substring(0, 20) + '...');
                        resolve(window.MP_DEVICE_SESSION_ID);
                    } else if (attempts < maxAttempts) {
                        setTimeout(checkDevice, 100);
                    } else {
                        console.warn('‚ö†Ô∏è Device fingerprint timeout - continuando sem ele');
                        resolve(null);
                    }
                };
                checkDevice();
            });
        }

        // SISTEMA DE POLLING
        let pollingInterval = null;
        let currentPaymentId = null;
        let isPaymentConfirmed = false;

        function startPolling(paymentId) {
            currentPaymentId = paymentId;
            console.log('üîÑ Iniciando polling:', paymentId);
            
            pollingInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${BACKEND_URL}/api/payment/${paymentId}`);
                    const data = await response.json();
                    
                    if (data.status === 'approved') {
                        console.log('‚úÖ PIX APROVADO!');
                        isPaymentConfirmed = true;
                        stopPolling();
                        showStatusScreen('success', data);
                    }
                } catch (error) {
                    console.error('‚ùå Erro no polling:', error);
                }
            }, 3000);
        }

        function stopPolling() {
            if (pollingInterval) {
                clearInterval(pollingInterval);
                pollingInterval = null;
            }
        }

        function updateStatusIndicator(type, message) {
            const indicator = document.getElementById('statusIndicator');
            indicator.className = `status-indicator ${type}`;
            indicator.textContent = `‚óè ${message}`;
            indicator.style.display = 'block';
        }

        // STATUS SCREENS
        function showStatusScreen(type = 'success', paymentData = {}) {
            const checkoutSection = document.getElementById('checkoutSection');
            const statusScreen = document.getElementById('statusScreen');
            const statusHeader = document.getElementById('statusHeader');
            const statusIcon = document.getElementById('statusIcon');
            const statusTitle = document.getElementById('statusTitle');
            const statusSubtitle = document.getElementById('statusSubtitle');
            const countdownSection = document.getElementById('countdownSection');
            const resultButton = document.getElementById('resultButton');
            const paymentId = document.getElementById('paymentId');
            const statusEmail = document.getElementById('statusEmail');
            const pixSection = document.getElementById('pixSection');

            // EXIBIR EMAIL REAL NO STATUS
            statusEmail.textContent = finalEmail;

            if (paymentData.id) paymentId.textContent = paymentData.id;

            checkoutSection.style.display = 'none';
                
            if (type === 'success') {
                statusHeader.className = 'status-header success';
                statusIcon.textContent = '‚úì';
                statusTitle.textContent = 'Seu pagamento foi aprovado';
                statusSubtitle.textContent = `Parab√©ns! Confirma√ß√£o enviada para ${finalEmail}. Acesse seu resultado personalizado.`;
                countdownSection.style.display = 'block';
                pixSection.style.display = 'none';
                resultButton.onclick = () => redirectToResult();
                startCountdown();
            } else if (type === 'pix') {
                statusHeader.className = 'status-header processing';
                statusIcon.textContent = '‚è≥';
                statusTitle.textContent = 'Pague com PIX';
                statusSubtitle.textContent = `Escaneie o QR Code ou copie o c√≥digo PIX. Confirma√ß√£o ser√° enviada para ${finalEmail}.`;
                countdownSection.style.display = 'none';
                
                if (paymentData.qr_code_base64) {
                    const qrImg = document.getElementById('pixQRCode');
                    qrImg.src = `data:image/png;base64,${paymentData.qr_code_base64}`;
                    qrImg.style.display = 'block';
                }
                
                if (paymentData.qr_code) {
                    document.getElementById('pixCode').textContent = paymentData.qr_code;
                    window.pixCodeToCopy = paymentData.qr_code;
                }
                
                pixSection.style.display = 'block';
                resultButton.textContent = 'J√° paguei - Ver resultado';
                resultButton.onclick = () => redirectToResult();
                
                if (paymentData.id) startPolling(paymentData.id);
            } else if (type === 'processing') {
                statusHeader.className = 'status-header processing';
                statusIcon.textContent = '‚è≥';
                statusTitle.textContent = 'Processando pagamento';
                statusSubtitle.textContent = `Aguarde... Confirma√ß√£o ser√° enviada para ${finalEmail}.`;
                resultButton.textContent = 'Aguarde...';
                resultButton.disabled = true;
            } else if (type === 'error') {
                statusHeader.className = 'status-header error';
                statusIcon.textContent = '‚ùå';
                statusTitle.textContent = 'Erro no pagamento';
                statusSubtitle.textContent = 'Tente novamente.';
                resultButton.textContent = 'Tentar Novamente';
                resultButton.onclick = () => location.reload();
            }

            statusScreen.style.display = 'block';
        }

        function startCountdown() {
            let seconds = 10;
            const timer = document.getElementById('countdownTimer');
            
            const interval = setInterval(() => {
                seconds--;
                timer.textContent = seconds;
                if (seconds <= 0) {
                    clearInterval(interval);
                    redirectToResult();
                }
            }, 1000);
        }

        function redirectToResult() {
            stopPolling();
            const finalUID = tallyUID || userUID;
            console.log('üéØ Redirecionando:', finalUID);
            window.location.href = `https://suellenseragi.com.br/resultado1?uid=${finalUID}`;
        }

        function copyPixCode() {
            if (window.pixCodeToCopy) {
                navigator.clipboard.writeText(window.pixCodeToCopy).then(() => {
                    const button = document.querySelector('.copy-button');
                    button.textContent = 'Copiado!';
                    setTimeout(() => button.textContent = 'Copiar c√≥digo', 2000);
                });
            }
        }

        // PAYMENT BRICK COM EMAIL REAL
        const renderPaymentBrick = async () => {
            try {
                console.log('üöÄ Criando Payment Brick com email real...');
                console.log('üìß Email que ser√° usado:', finalEmail);
                
                const deviceId = await waitForDeviceFingerprint();
                
                const settings = {
                    initialization: {
                        amount: 19,
                        // PRE-PREENCHER COM EMAIL REAL DA URL
                        payer: {
                            email: finalEmail
                        }
                    },
                    customization: {
                        paymentMethods: {
                            creditCard: "all",
                            debitCard: "all", 
                            bankTransfer: "all",
                            maxInstallments: 1
                        }
                    },
                    callbacks: {
                        onReady: () => {
                            console.log('‚úÖ Payment Brick carregado com email:', finalEmail);
                            updateStatusIndicator('success', 'Carregado');
                            
                            const loadingElement = document.querySelector('.loading-state');
                            if (loadingElement) loadingElement.style.display = 'none';
                        },
                        onSubmit: ({ selectedPaymentMethod, formData }) => {
                            console.log('üí≥ Processando pagamento com email real');
                            console.log('üìß Email do formData:', formData.payer?.email);
                            console.log('üìß Email final usado:', finalEmail);
                            
                            showStatusScreen('processing');

                            return new Promise((resolve, reject) => {
                                // GARANTIR QUE O EMAIL REAL SEJA USADO
                                const paymentPayload = {
                                    transaction_amount: 19,
                                    description: 'Teste de Prosperidade - Resultado Personalizado',
                                    payment_method_id: formData.payment_method_id,
                                    payer: {
                                        email: finalEmail // ‚Üê SEMPRE USAR EMAIL REAL DA URL
                                    },
                                    uid: userUID,
                                    device_id: deviceId
                                };

                                // Adicionar campos espec√≠ficos
                                if (formData.token) paymentPayload.token = formData.token;
                                if (formData.installments) paymentPayload.installments = formData.installments;
                                if (formData.issuer_id) paymentPayload.issuer_id = formData.issuer_id;
                                if (formData.payer?.identification) {
                                    paymentPayload.payer.identification = formData.payer.identification;
                                }

                                console.log('üì§ PAYLOAD COM EMAIL REAL:', paymentPayload);

                                fetch(`${BACKEND_URL}/api/process_payment`, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify(paymentPayload)
                                })
                                .then(response => {
                                    console.log('üì• Status:', response.status);
                                    if (!response.ok) {
                                        return response.json().then(err => {
                                            throw new Error(`HTTP ${response.status}: ${err.message || err.error}`);
                                        });
                                    }
                                    return response.json();
                                })
                                .then(result => {
                                    console.log('‚úÖ Resultado:', result);
                                    
                                    if (result.status === 'approved') {
                                        showStatusScreen('success', result);
                                        resolve();
                                    } else if (result.status === 'pending' && result.payment_method_id === 'pix') {
                                        showStatusScreen('pix', result);
                                        resolve();
                                    } else if (result.status === 'pending') {
                                        showStatusScreen('processing', result);
                                        resolve();
                                    } else {
                                        showStatusScreen('error', result);
                                        reject();
                                    }
                                })
                                .catch(error => {
                                    console.error('‚ùå Erro:', error);
                                    showStatusScreen('error');
                                    reject();
                                });
                            });
                        },
                        onError: (error) => {
                            console.error('‚ùå Erro Payment Brick:', error);
                        }
                    }
                };

                await bricksBuilder.create("payment", "paymentBrick_container", settings);
                console.log('‚úÖ Payment Brick criado com email real:', finalEmail);
                
            } catch (error) {
                console.error('‚ùå Erro ao criar Payment Brick:', error);
                document.getElementById('paymentBrick_container').innerHTML = `
                    <div class="loading-state">
                        <p style="color: #ff4d4f;">Erro ao carregar pagamentos</p>
                        <button onclick="location.reload()" 
                                style="margin-top: 12px; padding: 8px 16px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            Recarregar
                        </button>
                    </div>
                `;
            }
        };

        // INICIALIZA√á√ÉO
        async function testBackendConnection() {
            try {
                const response = await fetch(`${BACKEND_URL}/health`);
                const data = await response.json();
                return data.status === 'OK';
            } catch (error) {
                return false;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Inicializando checkout com email real');
            console.log('üìß Email final configurado:', finalEmail);
            
            // EXIBIR DADOS CAPTURADOS NA INTERFACE
            validateAndDisplayUserData();
            
            testBackendConnection().then(isOnline => {
                if (isOnline) {
                    console.log('‚úÖ Backend online');
                    updateStatusIndicator('success', 'Conectado');
                    renderPaymentBrick();
                } else {
                    console.error('‚ùå Backend offline');
                    updateStatusIndicator('error', 'Offline');
                }
            });
        });

        window.addEventListener('beforeunload', () => stopPolling());
    </script>
</body>
</html>